<!DOCTYPE html> <html lang="en-US"><head> <meta charset="utf-8"> <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"> <meta name="viewport" content="width=device-width, initial-scale=1"> <meta name="msapplication-TileImage" content="/jekyll/public/assets/icons/ms-icon-144x144.png"> <meta name="msapplication-TileColor" content="#0C2E3F"> <meta name="theme-color" content="#0C2E3F"> <link rel="apple-touch-icon" sizes="57x57" href="/jekyll/public/assets/icons/apple-icon-57x57.png"> <link rel="apple-touch-icon" sizes="60x60" href="/jekyll/public/assets/icons/apple-icon-60x60.png"> <link rel="apple-touch-icon" sizes="72x72" href="/jekyll/public/assets/icons/apple-icon-72x72.png"> <link rel="apple-touch-icon" sizes="76x76" href="/jekyll/public/assets/icons/apple-icon-76x76.png"> <link rel="apple-touch-icon" sizes="114x114" href="/jekyll/public/assets/icons/apple-icon-114x114.png"> <link rel="apple-touch-icon" sizes="120x120" href="/jekyll/public/assets/icons/apple-icon-120x120.png"> <link rel="apple-touch-icon" sizes="144x144" href="/jekyll/public/assets/icons/apple-icon-144x144.png"> <link rel="apple-touch-icon" sizes="152x152" href="/jekyll/public/assets/icons/apple-icon-152x152.png"> <link rel="apple-touch-icon" sizes="180x180" href="/jekyll/public/assets/icons/apple-icon-180x180.png"> <link rel="icon" type="image/png" sizes="192x192" href="/jekyll/public/assets/icons/android-icon-192x192.png"> <link rel="icon" type="image/png" sizes="32x32" href="/jekyll/public/assets/icons/favicon-32x32.png"> <link rel="icon" type="image/png" sizes="96x96" href="/jekyll/public/assets/icons/favicon-96x96.png"> <link rel="icon" type="image/png" sizes="16x16" href="/jekyll/public/assets/icons/favicon-16x16.png"> <link rel="shortcut icon" href="/jekyll/public/assets/icons/favicon.ico" type="image/x-icon"> <link rel="icon" href="/jekyll/public/assets/icons/favicon.ico" type="image/x-icon"> <link rel="manifest" href="/jekyll/manifest.json"> <link rel="preconnect" href="https://fonts.googleapis.com/" crossorigin> <link rel="preload" href="https://fonts.gstatic.com/s/sarpanch/v3/hESy6Xt4NCpRuk6Pzi2HTos.woff2" as="font" type="font/woff2" crossorigin> <link rel="preload" href="https://fonts.gstatic.com/s/sarpanch/v3/hES16Xt4NCpRuk6PziUEaZ7Y3nA.woff2" as="font" type="font/woff2" crossorigin> <link rel="preload" href="https://fonts.gstatic.com/s/sharetechmono/v7/J7aHnp1uDWRBEqV98dVQztYldFcLowEF.woff2" as="font" type="font/woff2" crossorigin> <link rel="preload" href="https://fonts.gstatic.com/s/teko/v7/LYjNdG7kmE0gfaN9pQ.woff2" as="font" type="font/woff2" crossorigin> <link rel="preload" href="/jekyll/public/css/style.css" as="style"> <script async defer src="/jekyll/public/javascript/vendor/page/page.js"></script> <script async defer src="/jekyll/public/javascript/main.js"></script><link type="application/atom+xml" rel="alternate" href="/jekyll/feed.xml" title="Russell Chapman" /><!-- Begin Jekyll SEO tag v2.5.0 --> <title>Image to ASCII | Russell Chapman</title> <meta name="generator" content="Jekyll v3.7.4" /> <meta property="og:title" content="Image to ASCII" /> <meta name="author" content="Russell Chapman" /> <meta property="og:locale" content="en_US" /> <meta name="description" content="Introduction description, how-to, article custom elements, canvas, es6" /> <meta property="og:description" content="Introduction description, how-to, article custom elements, canvas, es6" /> <meta property="og:site_name" content="Russell Chapman" /> <meta property="og:image" content="/jekyll/backgrounds/ascii.jpg" /> <meta property="og:type" content="article" /> <meta property="article:published_time" content="2017-10-12T00:00:00+00:00" /> <script type="application/ld+json"> {"description":"Introduction description, how-to, article custom elements, canvas, es6","image":"/jekyll/backgrounds/ascii.jpg","@type":"BlogPosting","headline":"Image to ASCII","dateModified":"2017-10-12T00:00:00+00:00","url":"/jekyll/posts/article/Ascii","datePublished":"2017-10-12T00:00:00+00:00","mainEntityOfPage":{"@type":"WebPage","@id":"/jekyll/posts/article/Ascii"},"author":{"@type":"Person","name":"Russell Chapman"},"@context":"http://schema.org"}</script> <!-- End Jekyll SEO tag --> </head> <body><nav class="navigation navigation--hidden"> <button class="navigation__button navigation__button--close" aria-label="Close Navigation"><i class="fa fa-times"></i></button> <section class="navigation__categories"> <h4>Categories</h4> <a class="navigation__link" href="/jekyll/">Home</a> <a class="navigation__link" href="/jekyll/posts/article/">Articles</a> <a class="navigation__link" href="/jekyll/posts/demo/">Demos</a> <a class="navigation__link" href="/jekyll/posts/news/">News</a> <a class="navigation__link" href="/jekyll/posts/about/">About</a> </section> </nav> <nav class="navigation__overlay"> <button class="navigation__button navigation__button--open" aria-label="Open Navigation"> <i class="fa fa-bars"></i> </button> <button class="navigation__button navigation__button--update navigation--hidden" aria-label="Updates Available"> <i class="fa fa-refresh"></i> </button> <button class="navigation__button navigation__button--top" aria-label="Scroll to top"> <i class="fa fa-chevron-up"></i> </button> </nav> <main class="content"> <article class="article"><h1 id="introduction">Introduction</h1> <ul> <li>description, how-to, article</li> <li>custom elements, canvas, es6</li> </ul> <p>This article is a how-to for some of those out there old enough to remember the heyday of BBS’es and MUDs. I was always fascinated by the talent of the folks good enough to make ASCII art that looked like real images. I decided to create an algorithm that would convert a real image into its ASCII representation. There should be some little tidbits of code that you might enjoy, even if you’re not a fan of the early internet.</p> <h1 id="background">Background</h1> <ul> <li>history <ul> <li>bbs door games</li> <li>roguelike</li> <li>terminal</li> <li>compression</li> <li>downsampling</li> </ul> </li> <li>generateCharacters <ul> <li>populates the character array with { character, average: { lightness, r, g, b, a }} objects</li> </ul> </li> <li>getCharacterAverage <ul> <li>draws a white character on a black background in a small canvas</li> <li>returns this characters’ average lightness from getImageDataAverage</li> </ul> </li> <li>getImageDataAverage <ul> <li>returns the average lightness and rgb for imageData</li> </ul> </li> <li>convertImage <ul> <li>iterates over a canvas in cell.width by cell.height blocks calling getMatchingCharacter</li> <li>returns matching characters array for entire image</li> </ul> </li> <li>getMatchingCharacter <ul> <li>returns a character that matches this imageData block lightness</li> </ul> </li> <li>based on the lightness for each pixel, output ASCII characters that have a matching lightness value</li> <li>calculate character lightness, find matching character for each pixel</li> </ul> <p>Lightness is how bright a white character will appear on a black background. For example, the character “#” appears to be much brighter than “:”.</p> <p>You can experiment with changing the character constants in the code to output different effects. I got particularly interesting results when I reversed the order of the output characters to get a “negative” effect.</p> <h1 id="using-the-code">Using the code</h1> <p>I’ve documented the code in the solution, but I will include my favorite method here for review. This method is the third type of ASCII art (mentioned above). It will take a posted file (via HTTP), read the pixels in, get the grayscale value of each pixel, then find the appropriate ASCII character to output.</p> <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">//% highlight javascript linenos %}</span>
<span class="c1">// % endhighlight %}</span>
</code></pre></div></div> <p>In a nutshell, we’re doing the following:</p> <ul> <li>Convert the Image object into a Bitmap object</li> <li>Enclose the output in HTML paragraph tags</li> <li>Loop through each pixel in the bitmap, and obtain the color</li> <li>Strip the color information from the pixel (see below)</li> <li>Find the character to use based on the new shade (see below)</li> <li>Aggregate all of the characters, then return the HTML</li> </ul> <h1 id="converting-to-pixels-to-lightness-values">Converting to pixels to lightness values</h1> <p>The simplest way to get a lightness value is by averaging all of the pixels’ rgb components.</p> <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code></code></pre></div></div> <h1 id="converting-lightness-values-to-characters">Converting lightness values to characters</h1> <p>In order to convert the lightness value to a character, we average blocks of pixels cell.width by cell.height and find a character in the array with a matching value. The values I’ve included with the demo code seem to work fairly well, but feel free to experiment with different character sets.</p> <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code></code></pre></div></div> <p>You can use as few or as many constants as you like. 9 seemed to provide good results. The constant values that I chose are are as follows:</p> <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">function</span> <span class="nx">getCharacterLightness</span><span class="p">(</span><span class="nx">character</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// clear canvas (black)</span>
  <span class="nx">ctx</span><span class="p">.</span><span class="nx">fillStyle</span> <span class="o">=</span> <span class="s2">"#000"</span><span class="p">;</span>
  <span class="nx">ctx</span><span class="p">.</span><span class="nx">fillRect</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">cell</span><span class="p">.</span><span class="nx">width</span><span class="p">,</span> <span class="nx">cell</span><span class="p">.</span><span class="nx">height</span><span class="p">);</span>

  <span class="c1">// draw the character (white)</span>
  <span class="nx">ctx</span><span class="p">.</span><span class="nx">fillStyle</span> <span class="o">=</span> <span class="s2">"#FFF"</span><span class="p">;</span>
  <span class="nx">ctx</span><span class="p">.</span><span class="nx">fillText</span><span class="p">(</span><span class="nx">character</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">cell</span><span class="p">.</span><span class="nx">height</span> <span class="o">/</span> <span class="mi">2</span><span class="p">);</span>

  <span class="kd">let</span> <span class="nx">data</span> <span class="o">=</span> <span class="nx">ctx</span><span class="p">.</span><span class="nx">getImageData</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">cell</span><span class="p">.</span><span class="nx">width</span><span class="p">,</span> <span class="nx">cell</span><span class="p">.</span><span class="nx">height</span><span class="p">).</span><span class="nx">data</span><span class="p">,</span> <span class="nx">avg</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

  <span class="c1">// running average of lightness for this imageData block</span>
  <span class="k">for</span> <span class="p">(</span><span class="kd">let</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">data</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span> <span class="o">+=</span> <span class="mi">4</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">let</span> <span class="nx">lightness</span> <span class="o">=</span> <span class="p">(</span><span class="nx">data</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">+</span> <span class="nx">data</span><span class="p">[</span><span class="nx">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="nx">data</span><span class="p">[</span><span class="nx">i</span><span class="o">+</span><span class="mi">2</span><span class="p">])</span> <span class="o">/</span> <span class="mi">3</span><span class="p">;</span>
    <span class="nx">avg</span> <span class="o">+=</span> <span class="nx">lightness</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="nx">avg</span> <span class="o">/=</span> <span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">length</span> <span class="o">/</span> <span class="mi">4</span><span class="p">);</span>
  <span class="k">return</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">round</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">min</span><span class="p">(</span><span class="nx">avg</span><span class="o">*</span><span class="mi">8</span><span class="p">,</span> <span class="mi">255</span><span class="p">));</span>
<span class="p">}</span>
</code></pre></div></div> <p>So now, as we get the gray shade for each pixel, we just output the corresponding ASCII character. The logo of my favorite team (Denver Broncos) now appears as follows:</p> <h1 id="points-of-interest">Points of interest</h1> <p>Many of you will notice that I did not use an HTML Text Writer to build the HTML. Simply put, it was more overhead than I needed. StringBuilder seemed to work very well, and though it doesn’t afford me the luxury of ensuring I have the right formatting, it is by far the fastest solution.</p> <p>Styling is handled by a CSS file (included). For this reason, the “class=’ascii_art’” bit was added to the opening paragraph tag. You may notice that the VS2005 IDE flags the “line-spacing” attribute in the CSS designer. Don’t worry… both IE and Firefox know how to handle it. Line spacing keeps the characters close so there is not a lot of whitespace between the lines. Also, it is important to use a MONOTYPE font (Lucida Console, Courier New, Terminal, etc.) for the font, otherwise your image will be extremely skewed.</p> <p>Currently, the solution just performs a Response.Write() of the HTML to the Default.aspx page on postback. This could obviously be modified to post to a separate page, but I chose not to for purposes of simplicity and illustration.</p> <p>Happy ASCII’ing!</p> <ul> <li><a href="/demo/js-ascii/">Demo</a></li> <li><a href="https://stackoverflow.com/questions/394882/how-do-ascii-art-image-conversion-algorithms-work">ASCII art image conversion algorithms</a></li> <li><a href="https://github.com/EnotionZ/jscii/blob/master/src/jscii.js">jscii.js</a></li> <li><a href="https://github.com/aemkei/ascii.js/blob/master/asciify.js">asciify.js</a></li> <li><a href="https://www.codeproject.com/Articles/20435/Using-C-To-Generate-ASCII-Art-From-An-Image">Using C# To Generate ASCII Art From An Image</a></li> </ul> </article> </main> <link rel="stylesheet" href="/jekyll/public/css/style.css"> <script defer src="/jekyll/public/javascript/vendor/page/page.js"></script> <script defer src="/jekyll/public/javascript/main.js"></script> </body> </html>
