<!DOCTYPE html> <html lang="en-US"><head> <meta charset="utf-8"> <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"> <meta name="viewport" content="width=device-width, initial-scale=1"> <meta name="msapplication-TileImage" content="/jekyll/public/assets/icons/ms-icon-144x144.png"> <meta name="msapplication-TileColor" content="#0C2E3F"> <meta name="theme-color" content="#0C2E3F"> <link rel="apple-touch-icon" sizes="57x57" href="/jekyll/public/assets/icons/apple-icon-57x57.png"> <link rel="apple-touch-icon" sizes="60x60" href="/jekyll/public/assets/icons/apple-icon-60x60.png"> <link rel="apple-touch-icon" sizes="72x72" href="/jekyll/public/assets/icons/apple-icon-72x72.png"> <link rel="apple-touch-icon" sizes="76x76" href="/jekyll/public/assets/icons/apple-icon-76x76.png"> <link rel="apple-touch-icon" sizes="114x114" href="/jekyll/public/assets/icons/apple-icon-114x114.png"> <link rel="apple-touch-icon" sizes="120x120" href="/jekyll/public/assets/icons/apple-icon-120x120.png"> <link rel="apple-touch-icon" sizes="144x144" href="/jekyll/public/assets/icons/apple-icon-144x144.png"> <link rel="apple-touch-icon" sizes="152x152" href="/jekyll/public/assets/icons/apple-icon-152x152.png"> <link rel="apple-touch-icon" sizes="180x180" href="/jekyll/public/assets/icons/apple-icon-180x180.png"> <link rel="icon" type="image/png" sizes="192x192" href="/jekyll/public/assets/icons/android-icon-192x192.png"> <link rel="icon" type="image/png" sizes="32x32" href="/jekyll/public/assets/icons/favicon-32x32.png"> <link rel="icon" type="image/png" sizes="96x96" href="/jekyll/public/assets/icons/favicon-96x96.png"> <link rel="icon" type="image/png" sizes="16x16" href="/jekyll/public/assets/icons/favicon-16x16.png"> <link rel="shortcut icon" href="/jekyll/public/assets/icons/favicon.ico" type="image/x-icon"> <link rel="icon" href="/jekyll/public/assets/icons/favicon.ico" type="image/x-icon"> <link rel="manifest" href="/jekyll/manifest.json"> <link rel="preconnect" href="https://fonts.googleapis.com/" crossorigin> <link rel="preload" href="https://fonts.gstatic.com/s/sarpanch/v3/hESy6Xt4NCpRuk6Pzi2HTos.woff2" as="font" type="font/woff2" crossorigin> <link rel="preload" href="https://fonts.gstatic.com/s/sarpanch/v3/hES16Xt4NCpRuk6PziUEaZ7Y3nA.woff2" as="font" type="font/woff2" crossorigin> <link rel="preload" href="https://fonts.gstatic.com/s/sharetechmono/v7/J7aHnp1uDWRBEqV98dVQztYldFcLowEF.woff2" as="font" type="font/woff2" crossorigin> <link rel="preload" href="https://fonts.gstatic.com/s/teko/v7/LYjNdG7kmE0gfaN9pQ.woff2" as="font" type="font/woff2" crossorigin> <link rel="preload" href="/jekyll/public/css/style.css" as="style"> <script async defer src="/jekyll/public/javascript/vendor/page/page.js"></script> <script async defer src="/jekyll/public/javascript/main.js"></script><link type="application/atom+xml" rel="alternate" href="/jekyll/feed.xml" title="Russell Chapman" /><!-- Begin Jekyll SEO tag v2.5.0 --> <title>WebSocket Client &amp; Server Implementation for Node | Russell Chapman</title> <meta name="generator" content="Jekyll v3.7.4" /> <meta property="og:title" content="WebSocket Client &amp; Server Implementation for Node" /> <meta name="author" content="Russell Chapman" /> <meta property="og:locale" content="en_US" /> <meta name="description" content="Program all the things…" /> <meta property="og:description" content="Program all the things…" /> <meta property="og:site_name" content="Russell Chapman" /> <script type="application/ld+json"> {"description":"Program all the things…","@type":"WebPage","headline":"WebSocket Client &amp; Server Implementation for Node","url":"/jekyll/public/javascript/tileEngine3/node_modules/websocket/","author":{"@type":"Person","name":"Russell Chapman"},"@context":"http://schema.org"}</script> <!-- End Jekyll SEO tag --> </head> <body><nav class="navigation navigation--hidden"> <button class="navigation__button navigation__button--close" aria-label="Close Navigation"><i class="fa fa-times"></i></button> <section class="navigation__categories"> <h4>Categories</h4> <a class="navigation__link" href="/jekyll/">Home</a> <a class="navigation__link" href="/jekyll/posts/article/">Articles</a> <a class="navigation__link" href="/jekyll/posts/demo/">Demos</a> <a class="navigation__link" href="/jekyll/posts/news/">News</a> <a class="navigation__link" href="/jekyll/posts/about/">About</a> </section> </nav> <nav class="navigation__overlay"> <button class="navigation__button navigation__button--open" aria-label="Open Navigation"> <i class="fa fa-bars"></i> </button> <button class="navigation__button navigation__button--update navigation--hidden" aria-label="Updates Available"> <i class="fa fa-refresh"></i> </button> <button class="navigation__button navigation__button--top" aria-label="Scroll to top"> <i class="fa fa-chevron-up"></i> </button> </nav> <main class="content"> <h1 id="websocket-client--server-implementation-for-node">WebSocket Client &amp; Server Implementation for Node</h1> <h2 id="overview">Overview</h2> <p>This is a (mostly) pure JavaScript implementation of the WebSocket protocol versions 8 and 13 for Node. There are some example client and server applications that implement various interoperability testing protocols in the “test” folder.</p> <h2 id="current-news">Current News</h2> <ul> <li> <p>As of version 1.0.7, <strong><em>Native modules are now optional.</em></strong> If they fail to compile, WebSocket-Node will still work but will not verify that received UTF-8 data is valid, and xor masking/unmasking of payload data for security purposes will not be as efficient as it is performed in JavaScript instead of native code.</p> </li> <li> <p>Version 1.0.7 requires node v0.6.10, since that’s the first version that I can manage to successfully build the native extensions with node-gyp through npm. If anyone can figure out how to build native extensions in a way that works with both older and newer versions of Node, I’m happy to accept a patch!</p> </li> <li> <p>If you want to support Unicode characters outside the Basic Multilingual Plane (BMP) you must use Node v0.8.x, which added support for representing these characters as surrogate pairs inside JavaScript strings. Under Node v0.6.x, characters with code points greater than 65535 (greater than a 16-bit unsigned value) will have their code point truncated, resulting in seemingly unpredictable characters being returned.</p> </li> <li> <p>WebSocket-Node was already <a href="http://hobbycoding.posterous.com/websockt-binary-data-transfer-benchmark-rsult">one of the fastest WebSocket libraries for Node</a>, and thanks to a small patch from <a href="https://github.com/kazuyukitanimura">kazuyukitanimura</a>, this library is now <a href="http://hobbycoding.posterous.com/how-to-make-websocket-work-2x-faster-on-nodej">up to 200% faster</a> as of version 1.0.3!</p> </li> </ul> <h2 id="changelog">Changelog</h2> <p>Current Version: 1.0.7</p> <p><a href="https://github.com/Worlize/WebSocket-Node/blob/master/CHANGELOG.md">View the changelog</a></p> <h2 id="browser-support">Browser Support</h2> <ul> <li>Firefox 7-9 (Old) (Protocol Version 8)</li> <li>Firefox 10+ (Protocol Version 13)</li> <li>Chrome 14,15 (Old) (Protocol Version 8)</li> <li>Chrome 16+ (Protocol Version 13)</li> <li>Internet Explorer 10 (Preview) (Protocol Version 13)</li> <li>Safari 6 (Protocol Version 13)</li> </ul> <p><strong><em>Safari older than 6.0 is not supported since it uses a very old draft of WebSockets</em></strong></p> <p>I made a decision early on to explicitly avoid maintaining multiple slightly different copies of the same code just to support the browsers currently in the wild. The major browsers that support WebSocket are on a rapid-release schedule (with the exception of Safari) and now that the final version of the protocol has been <a href="http://datatracker.ietf.org/doc/rfc6455/">published as an official RFC</a>, it won’t be long before support in the wild stabilizes on that version. My client application is in Flash/ActionScript 3, so for my purposes I’m not dependent on the browser implementations. <em>I made an exception to my stated intention here to support protocol version 8 along with 13, since only one minor thing changed and it was trivial to handle conditionally.</em> The library now interoperates with other clients and servers implementing draft -08 all the way up through the final RFC.</p> <p><strong><em>If you need to simultaneously support legacy browser versions that had implemented draft-75/draft-76/draft-00, take a look here: https://gist.github.com/1428579</em></strong></p> <p>For a WebSocket client written in ActionScript 3, see my <a href="https://github.com/Worlize/AS3WebSocket">AS3WebScocket</a> project.</p> <h2 id="benchmarks">Benchmarks</h2> <p>There are some basic benchmarking sections in the Autobahn test suite. I’ve put up a <a href="http://worlize.github.com/WebSocket-Node/benchmarks/">benchmark page</a> that shows the results from the Autobahn tests run against AutobahnServer 0.4.10, WebSocket-Node 1.0.2, WebSocket-Node 1.0.4, and ws 0.3.4.</p> <h2 id="autobahn-tests">Autobahn Tests</h2> <p>The very complete <a href="http://www.tavendo.de/autobahn/testsuite.html">Autobahn Test Suite</a> is used by most WebSocket implementations to test spec compliance and interoperability.</p> <p><strong>Note about failing UTF-8 tests:</strong> There are some UTF-8 validation tests that fail due to the fact that according to the ECMAScript spec, V8 and subsequently Node cannot support Unicode characters outside the BMP (Basic Multilingual Plane.) JavaScript’s String.fromCharCode() function truncates all code points to 16-bit, so you cannot decode higher plane code points in JavaScript. Google’s V8 uses UCS-2 as its internal string representation, and <a href="http://code.google.com/p/v8/issues/detail?id=761">they have no intention to change that any time soon</a>, so it is not possible to decode higher plane code points in C++, to the best of my knowledge, because those characters are not representable in UCS-2 anyway. The Autobahn Test Suite requires that all valid Unicode code points survive a complete round trip, including code points that represent non-existent characters and characters above the BMP. Since JavaScript cannot represent any characters with a code point &gt;= 65535, no JavaScript implementation of WebSockets can pass these UTF-8 tests without using a cheat, such as echoing back the original binary data without decoding and re-encoding the UTF-8 data, which is not representative of real-world practical application. <strong><em>I do not consider this to be a problem in the majority of circumstances</em></strong> since it is very unlikely to cause major issues in any real-world application as long as you don’t need to use characters outside the BMP. <strong>Update:</strong> This issue seems to have been resolved in the version of V8 used in Node 0.8.x. I believe they are using surrogate-pairs to accommodate characters that are outside the BMP, but I haven’t looked into it.</p> <ul> <li><a href="http://worlize.github.com/WebSocket-Node/test-report/servers/">View Server Test Results</a></li> <li><a href="http://worlize.github.com/WebSocket-Node/test-report/clients/">View Client Test Results</a></li> </ul> <h2 id="notes">Notes</h2> <p>This library has been used in production on <a href="https://www.worlize.com">worlize.com</a> since April 2011 and seems to be stable. Your mileage may vary.</p> <p><strong>Tested with the following node versions:</strong></p> <ul> <li>0.6.18</li> <li>0.8.6</li> </ul> <p>It may work in earlier or later versions but I’m not actively testing it outside of the listed versions. YMMV.</p> <h1 id="documentation">Documentation</h1> <p>For more complete documentation, see the <a href="https://github.com/Worlize/WebSocket-Node/wiki/Documentation">Documentation Wiki</a>.</p> <h2 id="installation">Installation</h2> <p>A few users have reported difficulties building the native extensions without first manually installing node-gyp. If you have trouble building the native extensions, make sure you’ve got a C++ compiler, and have done <code class="highlighter-rouge">npm install -g node-gyp</code> first.</p> <p>Native extensions are optional, however, and WebSocket-Node will work even if the extensions cannot be compiled.</p> <p>In your project root:</p> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ npm install websocket
</code></pre></div></div> <p>Then in your code:</p> <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">WebSocketServer</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'websocket'</span><span class="p">).</span><span class="nx">server</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">WebSocketClient</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'websocket'</span><span class="p">).</span><span class="nx">client</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">WebSocketFrame</span>  <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'websocket'</span><span class="p">).</span><span class="nx">frame</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">WebSocketRouter</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'websocket'</span><span class="p">).</span><span class="nx">router</span><span class="p">;</span>
</code></pre></div></div> <h2 id="note-for-windows-users">Note for Windows Users</h2> <p>Because there is a small C++ component used for validating UTF-8 data, you will need to install a few other software packages in addition to Node to be able to build this module:</p> <ul> <li><a href="http://www.microsoft.com/visualstudio/en-us/products/2010-editions/visual-cpp-express">Microsoft Visual C++</a></li> <li><a href="http://www.python.org/download/">Python 2.7</a> (NOT Python 3.x)</li> </ul> <h2 id="current-features">Current Features:</h2> <ul> <li>Licensed under the Apache License, Version 2.0</li> <li>Protocol version “8” and “13” (Draft-08 through the final RFC) framing and handshake</li> <li>Can handle/aggregate received fragmented messages</li> <li>Can fragment outgoing messages</li> <li>Router to mount multiple applications to various path and protocol combinations</li> <li>TLS supported for outbound connections via WebSocketClient</li> <li>TLS supported for server connections (use https.createServer instead of http.createServer) <ul> <li>Thanks to <a href="https://github.com/pors">pors</a> for confirming this!</li> </ul> </li> <li>Cookie setting and parsing</li> <li>Tunable settings <ul> <li>Max Receivable Frame Size</li> <li>Max Aggregate ReceivedMessage Size</li> <li>Whether to fragment outgoing messages</li> <li>Fragmentation chunk size for outgoing messages</li> <li>Whether to automatically send ping frames for the purposes of keepalive</li> <li>Keep-alive ping interval</li> <li>Whether or not to automatically assemble received fragments (allows application to handle individual fragments directly)</li> <li>How long to wait after sending a close frame for acknowledgment before closing the socket.</li> </ul> </li> </ul> <h2 id="known-issuesmissing-features">Known Issues/Missing Features:</h2> <ul> <li>No API for user-provided protocol extensions.</li> </ul> <h1 id="usage-examples">Usage Examples</h1> <h2 id="server-example">Server Example</h2> <p>Here’s a short example showing a server that echos back anything sent to it, whether utf-8 or binary.</p> <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#!/usr/bin/env node
</span><span class="kd">var</span> <span class="nx">WebSocketServer</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'websocket'</span><span class="p">).</span><span class="nx">server</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">http</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'http'</span><span class="p">);</span>

<span class="kd">var</span> <span class="nx">server</span> <span class="o">=</span> <span class="nx">http</span><span class="p">.</span><span class="nx">createServer</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">request</span><span class="p">,</span> <span class="nx">response</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">((</span><span class="k">new</span> <span class="nb">Date</span><span class="p">())</span> <span class="o">+</span> <span class="s1">' Received request for '</span> <span class="o">+</span> <span class="nx">request</span><span class="p">.</span><span class="nx">url</span><span class="p">);</span>
    <span class="nx">response</span><span class="p">.</span><span class="nx">writeHead</span><span class="p">(</span><span class="mi">404</span><span class="p">);</span>
    <span class="nx">response</span><span class="p">.</span><span class="nx">end</span><span class="p">();</span>
<span class="p">});</span>
<span class="nx">server</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="mi">8080</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">((</span><span class="k">new</span> <span class="nb">Date</span><span class="p">())</span> <span class="o">+</span> <span class="s1">' Server is listening on port 8080'</span><span class="p">);</span>
<span class="p">});</span>

<span class="nx">wsServer</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">WebSocketServer</span><span class="p">({</span>
    <span class="na">httpServer</span><span class="p">:</span> <span class="nx">server</span><span class="p">,</span>
    <span class="c1">// You should not use autoAcceptConnections for production</span>
    <span class="c1">// applications, as it defeats all standard cross-origin protection</span>
    <span class="c1">// facilities built into the protocol and the browser.  You should</span>
    <span class="c1">// *always* verify the connection's origin and decide whether or not</span>
    <span class="c1">// to accept it.</span>
    <span class="na">autoAcceptConnections</span><span class="p">:</span> <span class="kc">false</span>
<span class="p">});</span>

<span class="kd">function</span> <span class="nx">originIsAllowed</span><span class="p">(</span><span class="nx">origin</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// put logic here to detect whether the specified origin is allowed.</span>
  <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
<span class="p">}</span>

<span class="nx">wsServer</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">'request'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">request</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">originIsAllowed</span><span class="p">(</span><span class="nx">request</span><span class="p">.</span><span class="nx">origin</span><span class="p">))</span> <span class="p">{</span>
      <span class="c1">// Make sure we only accept requests from an allowed origin</span>
      <span class="nx">request</span><span class="p">.</span><span class="nx">reject</span><span class="p">();</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">((</span><span class="k">new</span> <span class="nb">Date</span><span class="p">())</span> <span class="o">+</span> <span class="s1">' Connection from origin '</span> <span class="o">+</span> <span class="nx">request</span><span class="p">.</span><span class="nx">origin</span> <span class="o">+</span> <span class="s1">' rejected.'</span><span class="p">);</span>
      <span class="k">return</span><span class="p">;</span>
    <span class="p">}</span>
    
    <span class="kd">var</span> <span class="nx">connection</span> <span class="o">=</span> <span class="nx">request</span><span class="p">.</span><span class="nx">accept</span><span class="p">(</span><span class="s1">'echo-protocol'</span><span class="p">,</span> <span class="nx">request</span><span class="p">.</span><span class="nx">origin</span><span class="p">);</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">((</span><span class="k">new</span> <span class="nb">Date</span><span class="p">())</span> <span class="o">+</span> <span class="s1">' Connection accepted.'</span><span class="p">);</span>
    <span class="nx">connection</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">'message'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">message</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">message</span><span class="p">.</span><span class="nx">type</span> <span class="o">===</span> <span class="s1">'utf8'</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'Received Message: '</span> <span class="o">+</span> <span class="nx">message</span><span class="p">.</span><span class="nx">utf8Data</span><span class="p">);</span>
            <span class="nx">connection</span><span class="p">.</span><span class="nx">sendUTF</span><span class="p">(</span><span class="nx">message</span><span class="p">.</span><span class="nx">utf8Data</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">message</span><span class="p">.</span><span class="nx">type</span> <span class="o">===</span> <span class="s1">'binary'</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'Received Binary Message of '</span> <span class="o">+</span> <span class="nx">message</span><span class="p">.</span><span class="nx">binaryData</span><span class="p">.</span><span class="nx">length</span> <span class="o">+</span> <span class="s1">' bytes'</span><span class="p">);</span>
            <span class="nx">connection</span><span class="p">.</span><span class="nx">sendBytes</span><span class="p">(</span><span class="nx">message</span><span class="p">.</span><span class="nx">binaryData</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">});</span>
    <span class="nx">connection</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">'close'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">reasonCode</span><span class="p">,</span> <span class="nx">description</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">((</span><span class="k">new</span> <span class="nb">Date</span><span class="p">())</span> <span class="o">+</span> <span class="s1">' Peer '</span> <span class="o">+</span> <span class="nx">connection</span><span class="p">.</span><span class="nx">remoteAddress</span> <span class="o">+</span> <span class="s1">' disconnected.'</span><span class="p">);</span>
    <span class="p">});</span>
<span class="p">});</span>
</code></pre></div></div> <h2 id="client-example">Client Example</h2> <p>This is a simple example client that will print out any utf-8 messages it receives on the console, and periodically sends a random number.</p> <p><em>This code demonstrates a client in Node.js, not in the browser</em></p> <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#!/usr/bin/env node
</span><span class="kd">var</span> <span class="nx">WebSocketClient</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'websocket'</span><span class="p">).</span><span class="nx">client</span><span class="p">;</span>

<span class="kd">var</span> <span class="nx">client</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">WebSocketClient</span><span class="p">();</span>

<span class="nx">client</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">'connectFailed'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'Connect Error: '</span> <span class="o">+</span> <span class="nx">error</span><span class="p">.</span><span class="nx">toString</span><span class="p">());</span>
<span class="p">});</span>

<span class="nx">client</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">'connect'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">connection</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'WebSocket client connected'</span><span class="p">);</span>
    <span class="nx">connection</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">'error'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"Connection Error: "</span> <span class="o">+</span> <span class="nx">error</span><span class="p">.</span><span class="nx">toString</span><span class="p">());</span>
    <span class="p">});</span>
    <span class="nx">connection</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">'close'</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'echo-protocol Connection Closed'</span><span class="p">);</span>
    <span class="p">});</span>
    <span class="nx">connection</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">'message'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">message</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">message</span><span class="p">.</span><span class="nx">type</span> <span class="o">===</span> <span class="s1">'utf8'</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"Received: '"</span> <span class="o">+</span> <span class="nx">message</span><span class="p">.</span><span class="nx">utf8Data</span> <span class="o">+</span> <span class="s2">"'"</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">});</span>
    
    <span class="kd">function</span> <span class="nx">sendNumber</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">connection</span><span class="p">.</span><span class="nx">connected</span><span class="p">)</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">number</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">round</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span> <span class="o">*</span> <span class="mh">0xFFFFFF</span><span class="p">);</span>
            <span class="nx">connection</span><span class="p">.</span><span class="nx">sendUTF</span><span class="p">(</span><span class="nx">number</span><span class="p">.</span><span class="nx">toString</span><span class="p">());</span>
            <span class="nx">setTimeout</span><span class="p">(</span><span class="nx">sendNumber</span><span class="p">,</span> <span class="mi">1000</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="nx">sendNumber</span><span class="p">();</span>
<span class="p">});</span>

<span class="nx">client</span><span class="p">.</span><span class="nx">connect</span><span class="p">(</span><span class="s1">'ws://localhost:8080/'</span><span class="p">,</span> <span class="s1">'echo-protocol'</span><span class="p">);</span>
</code></pre></div></div> <h2 id="request-router-example">Request Router Example</h2> <p>For an example of using the request router, see <code class="highlighter-rouge">libwebsockets-test-server.js</code> in the <code class="highlighter-rouge">test</code> folder.</p> <h2 id="resources">Resources</h2> <p>A presentation on the state of the WebSockets protocol that I gave on July 23, 2011 at the LA Hacker News meetup. <a href="http://www.scribd.com/doc/60898569/WebSockets-The-Real-Time-Web-Delivered">WebSockets: The Real-Time Web, Delivered</a></p> </main> <link rel="stylesheet" href="/jekyll/public/css/style.css"> <script defer src="/jekyll/public/javascript/vendor/page/page.js"></script> <script defer src="/jekyll/public/javascript/main.js"></script> </body> </html>
